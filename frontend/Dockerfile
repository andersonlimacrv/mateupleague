FROM node:current-alpine

WORKDIR /app

ARG VITE_FRONTEND_PORT
ARG VITE_BACKEND_PORT
ARG VITE_DEPLOY_API
ARG VITE_BROKER_API_URL
ARG VITE_BROKER_API_K

ENV VITE_FRONTEND_PORT=${VITE_FRONTEND_PORT}
ENV VITE_BACKEND_PORT=${VITE_BACKEND_PORT}
ENV VITE_DEPLOY_API=${VITE_DEPLOY_API}
ENV VITE_BROKER_API_URL=${VITE_BROKER_API_URL}
ENV VITE_BROKER_API_K=${VITE_BROKER_API_K}


COPY package.json package-lock.json ./
RUN npm ci

COPY . .

RUN npm run build

EXPOSE ${VITE_FRONTEND_PORT}

CMD ["sh", "-c", "npm run preview -- --port ${VITE_FRONTEND_PORT:-4173} --host"]
